<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Lobbies</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='lobby.css') }}">
    <!-- Use the same starfield styles as the main menu -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Starfield background identical to Main Menu (behind content) -->
    <div class="starfield-overlay" aria-hidden="true" style="z-index:0;">
        <div class="starfield-bg" id="lobbyStarfieldBg"></div>
    </div>

    <div class="container">
        <!-- <h1>Cosmic Lobbies</h1> -->
        <div class="buttons">
            <span class="btn-wrap"><a href="#" class="btn" id="createLobbyBtn"><span class="btn-label">open lobby</span></a></span>
            <span class="btn-wrap"><a href="#" class="btn" id="joinLobbyBtn"><span class="btn-label">join lobby</span></a></span>
        </div>
    </div>

    <div id="joinLobbyModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Join Lobby</h2>
            <p>enter the 8-symbol code to join</p>
            <input type="text" id="lobbyCodeInput" placeholder="Enter code..." maxlength="8">
            <span class="btn-wrap">
              <button class="btn" id="joinLobbySubmit">Join</button>
            </span>
        </div>
    </div>

    <script>
        const createLobbyBtn = document.getElementById('createLobbyBtn');
        const joinLobbyBtn = document.getElementById('joinLobbyBtn');
        const modal = document.getElementById('joinLobbyModal');
        const closeButton = document.querySelector('.close-button');
        const joinLobbySubmit = document.getElementById('joinLobbySubmit');
        const lobbyCodeInput = document.getElementById('lobbyCodeInput');

        createLobbyBtn.addEventListener('click', (e) => {
            e.preventDefault();
            fetch('/create_lobby', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                window.location.href = `/planet/${data.code}`;
            })
            .catch(error => {
                console.error('Error creating lobby:', error);
                alert('Could not create a lobby. Please try again.');
            });
        });

        joinLobbyBtn.addEventListener('click', (e) => {
            e.preventDefault();
            modal.style.display = 'block';
        });

        closeButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });

        joinLobbySubmit.addEventListener('click', () => {
            const code = lobbyCodeInput.value.toUpperCase();
            if (code.length > 0) { // Basic validation
                // No client-side validation of lobby existence, server will handle it
                window.location.href = `/planet/${code}`;
            } else {
                alert('Please enter a lobby code.');
            }
        });
    </script>
    <!-- Generate the same starfield/shooting stars as the main menu -->
    <script src="{{ url_for('static', filename='lobby-starfield.js') }}"></script>
</body>
</html>
